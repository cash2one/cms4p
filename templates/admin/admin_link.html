<form id="myForm" action="" class="well form-inline" method="post">
    <?py if obj: ?>
    <input type="text" name="name" value="#{obj.name}" class="input-xlarge" id="input01" required tabindex="1" placeholder="名称"/>
    <input type="text" name="sort" value="#{obj.displayorder}" class="input-medium" id="input02" tabindex="2" placeholder="排序"/>
    <input type="text" name="url" value="#{obj.url}" class="input-xlarge" id="input03" required tabindex="3" placeholder="URL"/>
    <input type='hidden' value='edit' name='act'/>
    <input type='hidden' value='#{obj.id}' name='id'/>
    <?py else: ?>
    <input type="text" name="name" value="" class="input-xlarge" id="input11" required tabindex="1" placeholder="名称"/>
    <input type="text" name="sort" value="" class="input-medium" id="input12" tabindex="2" placeholder="排序"/>
    <input type="text" name="url" value="" class="input-xlarge" id="input13" required tabindex="3" placeholder="URL"/>
    <input type='hidden' value='add' name='act'/>
    <?py #endif ?>
    <button type="submit" class="btn btn-primary">保 存</button>
    <button type="reset" class="btn">重 置</button>
</form>
<table class="table table-striped table-bordered table-condensed">
    <thead>
    <tr>
        <th>#</th>
        <th>名称</th>
        <th>排序</th>
        <th>URL</th>
        <th>可用操作</th>
    </tr>
    </thead>
    <tbody id="links">
    <?py for i in objs: ?>
    <tr id="link-#{i.id}">
        <td>#{i.id}</td>
        <td><a href="#{i.url}" title="Link to #{i.url}" target="_blank">#{i.name}</a></td>
        <td>#{i.displayorder}</td>
        <td>#{i.url}</td>
        <td><a href="/admin/links?id=#{i.id}&act=edit">编辑</a> <a href="/admin/links?id=#{i.id}&act=del" class="ajax" data-remove-closest="tr">删除</a></td>
    </tr>
    <?py #endfor ?>
    </tbody>
</table>
<span class="label label-info">提示</span> 本页最多显示 #{LINK_NUM} 条友情链接, 你可以在“<a href="/admin/setting3">系统设置</a>”里面修改.
<script type="text/javascript">
    $(function () {
        $("#link_page").addClass("active");
        $("input,select,textarea").not("[type=submit]").not("[type=reset]").jqBootstrapValidation();
        $('#myForm').submit(function () {
            var name = $("input[name='name']").val();
            var url = $("input[name='url']").val();
            var sort = $("input[name='sort']").val().trim();
            if (sort=="") $("input[name='sort']").val("0");
            $.ajax({
                type: 'POST',
                url: "",
                dataType: "json",
                data: $("#myForm").serialize(),
                success: function () {
                    SiQiTip.show("success", "保存成功！");
                    if ($("input[name='act']").val()=="add") {
                        $("#links").prepend("<tr><td>#</td><td><a href='"+url+"' title='Link to "+url+"' target='_blank'>"+name+"</a></td><td>"+sort+"</td><td>"+url+"</td><td><a href='/admin/links'>刷新</a></td></tr>");
                    }
                    else {
                        var id = $("input[name='id']").val();
                        $("#link-"+id).html("<td>"+id+"</td><td><a href='"+url+"' title='Link to "+url+"' target='_blank'>"+name+"</a></td><td>"+sort+"</td><td>"+url+"</td><td><a href='/admin/links?id="+id+"&act=edit'>编辑</a> <a href='/admin/links?id="+id+"&act=del' class='ajax' data-remove-closest='tr'>删除</a></td>");
                    }
                    $("input").val("");
                },
                error: function() {
                    SiQiTip.show("error", "保存失败！");
                }
            });
            return false;
        });
    });
</script>